#!/bin/bash
set -e

case "$1" in
    configure)
        # Create enabled directories for components
        mkdir -p /usr/share/bash-it/aliases/enabled
        mkdir -p /usr/share/bash-it/plugins/enabled  
        mkdir -p /usr/share/bash-it/completion/enabled
        
        # Fix ownership - critical for proper functioning
        chown -R root:root /usr/share/bash-it/
        
        # Set proper permissions
        chmod -R 755 /usr/share/bash-it/
        chmod 755 /usr/share/bash-it/bash_it.sh
        chmod 755 /usr/share/bash-it/install.sh
        chmod 755 /usr/share/bash-it/uninstall.sh
        
        # Make scripts executable
        find /usr/share/bash-it/scripts -type f -name "*.sh" -exec chmod 755 {} \; 2>/dev/null || true
        find /usr/share/bash-it/scripts -type f -name "bash-it" -exec chmod 755 {} \; 2>/dev/null || true
        
        # Set permissions for enabled directories
        chmod 755 /usr/share/bash-it/aliases/enabled
        chmod 755 /usr/share/bash-it/plugins/enabled
        chmod 755 /usr/share/bash-it/completion/enabled
        
        echo "bash-it has been installed to /usr/share/bash-it"
        echo ""
        echo "To enable bash-it for your user, run:"
        echo "  bash-it install"
        echo ""  
        echo "After installation, you can manage components with:"
        echo "  bash-it show aliases    # Show available aliases"
        echo "  bash-it enable alias git # Enable git aliases"
        echo "  bash-it help            # Show all commands"
        echo ""
        echo "For more information, see: /usr/share/doc/bash-it/"
	echo "Type exec bash or start a new terminal to start"
        ;;
esac

exit 0
